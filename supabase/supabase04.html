<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Supabase JWT í™•ì¸</title>
</head>

<body>
    <h1>ğŸ” Supabase Access Token í™•ì¸ê¸°</h1>
    <form id="login-form">
        <label>
            ì´ë©”ì¼:
            <input type="email" id="email" required value="shantian.tw+01@gmail.com">
        </label>
        <br><br>
        <label>
            ë¹„ë°€ë²ˆí˜¸:
            <input type="password" id="password" required>
        </label>
        <br><br>
        <button type="submit">ë¡œê·¸ì¸</button>
    </form>

    <pre id="output"></pre>
    <pre id="result"></pre>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js'

        // ğŸ‘‡ ì—¬ê¸°ì— ë³¸ì¸ì˜ Supabase í”„ë¡œì íŠ¸ ì •ë³´ ì…ë ¥
        const supabaseUrl = 'https://zqaizmjhhrkkldcekctj.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpxYWl6bWpoaHJra2xkY2VrY3RqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUzODczNTQsImV4cCI6MjA2MDk2MzM1NH0.l-TipfI-oCPH07e5bafs2XfpR0k-NECHzoUiJyWqaOw';

        const supabase = createClient(supabaseUrl, supabaseAnonKey);
        async function fetchHumansData() {
        }


        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const output = document.getElementById('output');

            output.textContent = 'ğŸ”„ ë¡œê·¸ì¸ ì¤‘...';

            const { data, error } = await supabase.auth.signInWithPassword({
                email,
                password, options: {
                    redirectTo: 'http://192.168.0.102:5500/ch01/index.html'
                }

            });

            if (error) {
                output.textContent = `âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨: ${error.message}`;
                return;
            }

            const token = data.session.access_token;
            output.textContent = `âœ… ë¡œê·¸ì¸ ì„±ê³µ!\n\nğŸ” access_token:\n${token}`;
            console.log('ğŸ” access_token:', token);
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Loading data...</p>';

            try {
                // API í‚¤ì™€ ì¸ì¦ í† í°ì€ ì‹¤ì œ ì‚¬ìš© ì‹œ ë³´ì•ˆì— ìœ ì˜í•´ì•¼ í•©ë‹ˆë‹¤
                // ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ë°±ì—”ë“œ ì„œë²„ë¥¼ í†µí•´ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤
                const response = await fetch(supabaseUrl + "/rest/v1/humans", {
                    method: "GET",
                    headers: {
                        "Accept": "*/*",
                        "User-Agent": "Thunder Client (https://www.thunderclient.com)",
                        "Content-Type": "application/json",
                        "apikey": supabaseAnonKey,
                        "Authorization": "Bearer " + token,
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                resultDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                console.log("Fetched data:", data);
            } catch (error) {
                console.error("Error:", error);
                resultDiv.innerHTML = `<p style="color: red;">Error fetching data: ${error.message}</p>`;
            }
        });
    </script>
</body>

</html>