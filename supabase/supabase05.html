<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Supabase ì¸ì¦ + Human CRUD</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supaba
se.min.js"></script>
    <script>
        const supabaseUrl = 'https://zqaizmjhhrkkldcekctj.supabase.co';
        const supabaseKey =
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpxYWl6bWpoaHJra2xkY2VrY3RqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDUzODczNTQsImV4cCI6MjA2MDk2MzM1NH0.l-TipfI-oCPH07e5bafs2XfpR0k-NECHzoUiJyWqaOw';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        window.addEventListener('DOMContentLoaded', () => {
            // ë¡œê·¸ì¸ í¼ ì²˜ë¦¬
            document.getElementById('auth-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const output = document.getElementById('output');
                output.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
                const { data, error } = await supabase.auth.signInWithPassword({
                    email, password, options: {
                        redirectTo: document.location.href
                    }
                });
                if (error) {
                    output.textContent = 'X ' + error.message;
                } else {
                    output.textContent = 'ë¡œê·¸ì¸ ì„±ê³µ!';
                    readRecords(); // ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ìë™ ì¡°íšŒ
                    updateLoginStatus();
                }
            });
            // íšŒì›ê°€ì… ì²˜ë¦¬
            document.getElementById('signup-btn').addEventListener('click', async () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const output = document.getElementById('output');
                const { data, error } = await supabase.auth.signUp({
                    email, password
                    , options: {
                        emailRedirectTo: document.location.href
                    }
                });
                if (error) {
                    output.textContent = 'X ' + error.message;
                } else {
                    output.textContent = 'íšŒì›ê°€ì… ì™„ë£Œ\n' + JSON.stringify(data, null,
                        2);
                }
            });
            // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
            document.getElementById('logout-btn').addEventListener('click', async () => {
                await supabase.auth.signOut();
                updateLoginStatus();
            });
            // ë¡œê·¸ì¸ ìƒíƒœ ìë™ ì—…ë°ì´íŠ¸
            updateLoginStatus();
            readRecords();
            supabase
                .channel('realtime:humans')
                .on(
                    'postgres_changes',
                    { event: '*', schema: 'public', table: 'humans' },
                    (payload) => {
                        console.log('ğŸ” ì‹¤ì‹œê°„ ë³€ê²½ ê°ì§€:', payload);
                        readRecords();
                    }
                )
                .subscribe();
        });
        // ë¡œê·¸ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        async function updateLoginStatus() {
            const { data: { session } } = await supabase.auth.getSession();
            const output = document.getElementById('output');
            console.log(session);
            if (session) {
                output.textContent = `ë¡œê·¸ì¸ ìƒíƒœ: ${session.user.email}`;
            } else {
                output.textContent = 'ë¡œê·¸ì¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
            }
        }
        // ë°ì´í„° ì¡°íšŒ í•¨ìˆ˜
        async function readRecords() {
            const { data: records, error } = await
                supabase.from("humans").select("*").order("role", { ascending: true });
            if (error) return alert("Read Error: " + error.message);
            const historyDiv = document.getElementById("history");
            historyDiv.innerHTML = "";
            records.forEach(record => {
                const div = document.createElement("div");
                div.className = "record role-" + record.role;
                div.innerHTML = `<strong>${record.name}</strong><br>
ë‚˜ì´: ${record.age}ì„¸, í‚¤: ${record.height}cm<br>
ìƒì¼: ${new Date(record.birthday).toLocaleString()}<br>
ê²°í˜¼ ì—¬ë¶€: ${record.is_married ? "ê¸°í˜¼" : "ë¯¸í˜¼"}<br>
ê¶Œí•œ: ${record.role}<br>
ID: ${record.id}`;
                historyDiv.appendChild(div);
            });
        }
        async function createRecord() {
            const name = document.getElementById("name").value;
            const age = parseInt(document.getElementById("age").value);
            const height = parseFloat(document.getElementById("height").value);
            const birthday = document.getElementById("birthday").value;
            const is_married = document.getElementById("is_married").checked;
            const role = document.querySelector('input[name="role"]:checked').value;
            if (!name || !age || !height || !birthday) return alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            const { data, error } = await supabase.from("humans").insert([{
                name,
                age, height, birthday, is_married, role
            }]).select();
            if (error) return alert("Create Error: " + error.message);
            readRecords();
        }
        async function updateRecord() {
            const id = prompt("ìˆ˜ì •í•  IDë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (!id) return;
            const name = document.getElementById("name").value;
            const age = parseInt(document.getElementById("age").value);
            const height = parseFloat(document.getElementById("height").value);
            const birthday = document.getElementById("birthday").value;
            const is_married = document.getElementById("is_married").checked;
            const role = document.querySelector('input[name="role"]:checked').value;
            if (!name || !age || !height || !birthday) return alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
const { error } = await supabase.from("humans").update({
                name, age,
                height, birthday, is_married, role
            }).eq("id", id);
            if (error) return alert("Update Error: " + error.message);
            readRecords();
        }
        async function deleteRecord() {
            const id = prompt("ì‚­ì œí•  IDë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            if (!id) return;
            const { error } = await supabase.from("humans").delete().eq("id", id);
            if (error) return alert("Delete Error: " + error.message);
            readRecords();
        }
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }

        #container,
        #crud-section {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 2px 2px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        input[type="text"],
        input[type="number"],
        input[type="datetime-local"],
        input[type="email"],
        input[type="password"] {
            width: 100%;
            margin: 10px -10px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        input[type="checkbox"],
        input[type="radio"] {
            transform: scale(0.9);
        }

        button {
            width: 48%;
            padding: 10px;
            margin: 5px;
            border: none;
            cursor: pointer;
            background-color: #008CBA;
            border-radius: 4px;
        }

        .btn-create {
            background: #4CAF50;
        }

        .btn-read {
            background: #008CBA;
        }

        .btn-update {
            background: #f39c12;
        }

        .btn-delete {
            background: #e74c3c;
        }

        .record {
            text-align: left;
            background: #f9f9f9;
            padding: 10px;
            margin: 10px 0;
            border-left: 5px solid #4CAF50;
        }

        .role-supaadmin {
            border-left-color: #4CAF50;
        }

        .role-admin {
            border-left-color: #008CBA;
        }

        .role-user {
            border-left-color: #f39c12;
        }
    </style>
</head>

<body>
    <div id="container">
        <h1>HUMAN </h1>
        <form id="auth-form">
            <label>
                ì´ë©”ì¼:
                <input type="email" id="email" required>
            </label><br><br>
            <label>
                ë¹„ë°€ë²ˆí˜¸:
                <input type="password" id="password" required>
            </label><br><br>
            <button type="submit">ë¡œê·¸ì¸</button>
            <button type="button" id="signup-btn">íšŒì›ê°€ì…</button>
        </form>
        <pre id="output"></pre>
        <button id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
    <div id="crud-section">
        <h2>Human í…Œì´ë¸” CRUD</h2>
        <input type="text" id="name" placeholder="ì´ë¦„ ì…ë ¥" />
        <input type="number" id="age" placeholder="ë‚˜ì´ ì…ë ¥" />
        <input type="number" step="0.1" id="height" placeholder="í‚¤(cm) ì…ë ¥" />
        <input type="datetime-local" id="birthday" placeholder="ìƒì¼ ì…ë ¥" />
        <br>
        <div>
            <label><input type="checkbox" id="is_married" /> ê²°í˜¼ ì—¬ë¶€</label>
        </div>
        <br>
        <div>
            <label><input type="radio" name="role" value="supaadmin" checked />ìŠˆíŒŒê´€ë¦¬ì</label>
            <label><input type="radio" name="role" value="admin" /> ê´€ë¦¬ì</label>
            <label><input type="radio" name="role" value="user" /> ì‚¬ìš©ì</label>
        </div>
        <br>
        <button class="btn-create" onclick="createRecord()">ë ˆì½”ë“œ ì¶”ê°€</button>
        <button class="btn-read" onclick="readRecords()">ì¡°íšŒ</button>
        <button class="btn-update" onclick="updateRecord()">ìˆ˜ì •</button>
        <button class="btn-delete" onclick="deleteRecord()">ì‚­ì œ</button>
        <div id="history"></div>
    </div>
</body>

</html>